# Контрольная по запросам

## База данных

Схема базы данных «Соревнования по программированию».

![](https://imgur.com/a/xbGRGys)

В таблице _Runs_:

*   _SubmitTime_ – целое число минут, прошедших с начала соревнования;
*   _Accepted_ – `1`, если зачтено, иначе `0`.

Примеры исходных данных можно найти в [тестовом полигоне](https://www.kgeorgiy.info/courses/dbms/slides/misc/relations.html). -> [в папке репозитория](./data)

## Запросы

Реализуйте запросы к базе данных «Соревнования по программированию»

1.  Запишите следующие запросы в терминах реляционной алгебры и на языке SQL
    1.  Идентификаторы команд, участвующих в соревновании (_TeamId_ по _:ContestId_).
    2.  Названия команд, участвующих в соревновании (_TeamName_ по _:ContestId_).
    3.  Неудачные подходы в соревновании (_RunId_, _SessionId_, _Letter_, _SubmitTime_ по _:ContestId_).
    4.  Команды, не пославшие ни одной задачи в соревновании (_TeamName_ по _:ContestId_).
    5.  Команды, не сделавшие ни одного подхода хотя бы в одном соревновании (_TeamName_).
    6.  Команды не сделавшие ни одного подхода хотя бы в одном соревновании, в котором они участвовали (_TeamName_).
    7.  Сессии, сделавшие подходы по всем задачам в соревновании (_SessionId_).
    8.  Сессии, в которых решены все задачи соревнования (_SessionId_).
    9.  Команды, сделавшие неудачные подходы по всем задачам хотя бы в одном соревновании (_TeamName_).
    10.  Задачи в которых ошиблись все команды, участвовавшие в соревновании (_ContestId_, _Letter_).
2.  Запишите следующие запросы на языках Datalog и SQL
    1.  Идентификаторы команд, ошибшихся в задаче (_TeamId_ по _:ContestId_, _:Letter_).
    2.  Названия команд, не решивших задачу (_TeamName_ по _:ContestId_, _:Letter_).
    3.  Команды, ошибившиеся хотя бы одной задачи в соревнования (_TeamId_ по _:ContestId_).
    4.  Задачи, решённые всеми сессиями, участвовашими в соревновании (_ContestId_, _Letter_).
    5.  Команды, решившие все задачи, не решённые заданной командой (_TeamId_ по _:TeamId_).
    6.  Задачи которые не решила ни одна команда, участвовавшая в соревновании (_ProblemName_).
3.  Запишите изменяющие запросы на языке SQL
    1.  Удалить все подходы команды (_TeamId_).
    2.  Удалить все подходы соревнования (_ContestName_).
    3.  Для каждой команды, участвовавшей в соревновании добавить новую сессию с текущим временем начала (_current_timestamp_) (_ContestId_).
    4.  Сделать последний ошибочный подход в каждой сессии успешным.
    5.  Сделать первый подход по каждой задаче в каждой сессии ошибочным.
    6.  Для каждой сессии, пытавшейся, но не решившей задачу добавить успешный подход через минуту после последнего подхода по этой задаче. (_ContestId_).
    7.  Для каждой сессии сделать успешный подход по задаче с нулевым временем. Если задача уже была решена, то изменить время успешного подхода. [Не проверяется на _SQLite_.] (_ContestId_, _Letter_).
4.  Запишите агрегирующие запросы на языке SQL
    1.  Для каждой сессии число задач, по которым были подходы (_SessionId_, _Opened_).
    2.  Для каждой команды число задач, по которым были подходы (_TeamId_, _Opened_).
    3.  Задачи соревнования, которые решило минимальное число сессий (_Letter_ по _:ContestId_).
    4.  Для каждого соревнования, задачи, которые решило максимальное число сессий (_ContestId_, _Letter_).
    5.  Месяцы, в которые создано максимальное число сессий, решивших хотя бы одну задачу, в формате _mm-yyyy_. [Не проверяется на _SQLite_.] (_MonthStr_).
    6.  Для каждого соревнования найти команду, совершившую последний удачный подход (_ContestId_, _TeamName_, _SubmitTime_).
    7.  Посчитать число задач, решённых командами. Команды должны быть упорядочены по числу решешенных задач; при равенстве результатов — по убыванию времени начала. (_TeamName_, _Solved_ по _:ContestId_).
    8.  Посчитать штрафное время, полученное командами. Команды должны быть упорядочены по штрафному времени; при равенстве результатов — по убыванию времени начала. (_TeamName_, _Solved_, _Penalty_ по _:ContestId_).
    9.  Построить по соревнованию колонки «решено задач» и «штрафное время» Порядок команд должен быть правильным; при равенстве результатов — по убыванию времени начала (_TeamName_, _Solved_, _Penalty_ по _:ContestId_).
